<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <title>
      TEST
    </title>
    <meta name="description" content="${description}" />
    
    <style>

*, *:before, *:after {
      box-sizing: border-box; 
    }
    html {
      font-size: 62.5%;
    }
    body {
      color: #444;
      background-color: hsl(0, 0%, 96%);
    }
    h1 {
      font-size: 1.8rem;
    }

    </style>
  </head>
  <body>
    <script src="http://cdn.rawgit.com/phi-jp/phina.js/v0.2.0/build/phina.js"></script>
    <script>
        phina.globalize();

        //定数
        var SPEED = 8; // 移動速度
        var STONE_NUM = 20; // 石の数
        var SCREEN_WIDTH   = 640; // 画面横サイズ
        var SCREEN_HEIGHT  = 800; // 画面縦サイズ
        var SHAPE_SIZE = 16;
        var SHAPE_HALF = SHAPE_SIZE / 2;

      var ASSETS = {
        // 画像
        image: {
          'tomapiko': 'https://rawgit.com/phi-jp/phina.js/develop/assets/images/tomapiko_ss.png',
            // 地面
            'ground': 'https://rawgit.com/alkn203/tomapiko_void/master/assets/image/ground.png',
            // 岩
            'stone': 'https://rawgit.com/alkn203/tomapiko_void/master/assets/image/ground.png',
        },
        // スプライトシート
        spritesheet: {
          "tomapiko_ss":
          {
            // フレーム情報
            "frame": {
              "width": 64, // 1フレームの画像サイズ（横）
              "height": 64, // 1フレームの画像サイズ（縦）
              "cols": 6, // フレーム数（横）
              "rows": 3, // フレーム数（縦）
            },
            // アニメーション情報
            "animations" : {
              "walk": { // アニメーション名
                "frames": [12,13,14], // フレーム番号範囲
                "next": "walk", // 次のアニメーション
                "frequency": 6, // アニメーション間隔
              },
            }
          },
        }
      };       
      /*
       * メインシーン
       */
        phina.define("MainScene", {
          // 継承
          superClass: 'DisplayScene',
          // コンストラクタ
          init: function() {
            // 親クラス初期化
           this.superInit({
              // 画面サイズ
              width: SCREEN_WIDTH,
              height: SCREEN_HEIGHT,
            });
            // 背景
            this.backgroundColor = 'skyblue';
            // カスタムgrid
            // デフォルトには16ｘ16のgridが設定される、新たに画面の横サイズを１０分割する
            var grid = Grid(SCREEN_WIDTH, 10);
            // 繰り返し処理
            var self = this;
            (10).times(function(i){
              // 地面配置
              Ground().addChildTo(self).setPosition(grid.span(i), grid.span(11.5));
            });

            // トマピヨの初期位置
            var tomapiko = Sprite('tomapiko', 64, 64).addChildTo(this);
            tomapiko.x = this.gridX.center();
            tomapiko.y = this.gridY.span(14.2);
            var anim = FrameAnimation('tomapiko_ss').attachTo(tomapiko);
            // アニメーションを指定する
            anim.gotoAndPlay('walk');
            // 更新処理
            tomapiko.update = function(app) {
              var key = app.keyboard;
              // 左右移動,向き
              if (key.getKey('left')) {
                tomapiko.x -= SPEED;
                tomapiko.scaleX = 1;
              }
              if (key.getKey('right')) {
                tomapiko.x += SPEED;
                tomapiko.scaleX = -1;
              }

              if (tomapiko.left < 0) {
                tomapiko.x += SPEED;
              } else if (640 < tomapiko.right) {
                tomapiko.x -= SPEED;
              }
            };
           
            var stone = CircleShape({
              radius: 20,
              fill: 'blue',
            }).addChildTo(this);

             stone.physical.gravity.y = 0.2;
                             // 更新処理
            this.update = function() {
              // 判定用の円
              var c = Circle(tomapiko.x, tomapiko.y, tomapiko.radius);
              
              // 石と衝突判定
              if (Collision.testCircleCircle(c, stone)) {
                // 石に当たったら
                // this.exit();
                console.log("HIT!");
              } else {
                stone.fill = 'blue';
              }
            };
          

          },
        });

      /*
       * 地面クラス
       */
       phina.define('Ground', {
        // 継承
        superClass: 'Sprite',
        // コンストラクタ
        init: function() {
          // 親クラス初期化
          this.superInit('ground');
          // 原点を左上
          this.origin.set(0,0);
        },
       });
      /*
       * 岩クラス
       */
       phina.define('stone', {
        superClass: 'Sprite',
        // コンストラクタ
        init: function() {
          this.superInit('stone');
        this.x = Random.randint(SHAPE_HALF, SCREEN_WIDTH - SHAPE_HALF);
         this.y = Random.randint(SHAPE_HALF, SCREEN_WIDTH - SHAPE_HALF);
        },/
        
       });
       // hoge
       /*
       * メイン処理
       */
      phina.main(function() {
        // アプリケーションを生成
        var app = GameApp({
          title: "トマピコドッジ",
          assets: ASSETS,
          tartLabel: 'main',
          // startLabel: 'splash',
        });
        // 実行
        app.run();
      });
    </script>
  </body>
</html>


