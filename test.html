<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
    <title>
      TEST
    </title>
    <meta name="description" content="${description}" />
    
    <style>

*, *:before, *:after {
      box-sizing: border-box; 
    }
    html {
      font-size: 62.5%;
    }
    body {
      color: #444;
      background-color: hsl(0, 0%, 96%);
    }
    h1 {
      font-size: 1.8rem;
    }

    </style>
  </head>
  <body>
    <script src="http://cdn.rawgit.com/phi-jp/phina.js/v0.2.0/build/phina.js"></script>
    <script>
        phina.globalize();

        //定数
        var SPEED = 8; // 移動速度
        var STONE_NUM = 20; // 石の数
        var SCREEN_WIDTH = 640;
        var SCREEN_HEIGHT = 960;
        var SHAPE_SIZE = 16;
        var SHAPE_HALF = SHAPE_SIZE / 2;

      var ASSETS = {
        // 画像
        image: {
          'tomapiko': 'https://rawgit.com/phi-jp/phina.js/develop/assets/images/tomapiko_ss.png',
        },
        // スプライトシート
        spritesheet: {
          "tomapiko_ss":
          {
            // フレーム情報
            "frame": {
              "width": 64, // 1フレームの画像サイズ（横）
              "height": 64, // 1フレームの画像サイズ（縦）
              "cols": 6, // フレーム数（横）
              "rows": 3, // フレーム数（縦）
            },
            // アニメーション情報
            "animations" : {
              "walk": { // アニメーション名
                "frames": [12,13,14], // フレーム番号範囲
                "next": "walk", // 次のアニメーション
                "frequency": 6, // アニメーション間隔
              },
            }
          },
        }
      };       
      /*
       * メインシーン
       */
        phina.define("MainScene", {
          // 継承
          superClass: 'DisplayScene',
          // コンストラクタ
          init: function() {
            // 親クラス初期化
           this.superInit({
              // 画面サイズ
              width: 640,
            });
            // 背景
            this.backgroundColor = 'skyblue';

            // トマピヨの初期位置
            var tomapiko = Sprite('tomapiko', 64, 64).addChildTo(this);
            tomapiko.x = this.gridX.center();
            tomapiko.y = this.gridY.span(15);
            var anim = FrameAnimation('tomapiko_ss').attachTo(tomapiko);
            // アニメーションを指定する
            anim.gotoAndPlay('walk');
            // 更新処理
            tomapiko.update = function(app) {
              var key = app.keyboard;
              // 左右移動,向き
              if (key.getKey('left')) {
                tomapiko.x -= SPEED;
                tomapiko.scaleX = 1;
              }
              if (key.getKey('right')) {
                tomapiko.x += SPEED;
                tomapiko.scaleX = -1;
              }

              if (tomapiko.left < 0) {
                tomapiko.x += SPEED;
              } else if (640 < tomapiko.right) {
                tomapiko.x -= SPEED;
              }
            };

            // ラベル
            var label = Label({
              text: '',
              fontSize: 30,
              x: this.gridX.center(),
              y: this.gridY.span(0.5),
            }).addChildTo(this);
            this.update = function(app) {
              // 経過秒数表示
              label.text = '経過秒数:' + Math.floor(app.elapsedTime / 1000);
            };

           
            for (var i = 1; i <= STONE_NUM; i++) {
                var stone = CircleShape({
                  radius: 20,
                  fill: 'blue',
                }).addChildTo(this);
                 stone.x = Random.randint(SHAPE_HALF, SCREEN_WIDTH - SHAPE_HALF);
                 stone.y = Random.randint(SHAPE_HALF, SCREEN_WIDTH - SHAPE_HALF);
                 stone.physical.gravity.y = 0.2;
                                 // 更新処理
                this.update = function() {
                  // 判定用の円
                  var c = Circle(tomapiko.x, tomapiko.y, tomapiko.radius);
                  
                  // 石と衝突判定
                  if (Collision.testCircleCircle(c, stone)) {
                    // 石に当たったら
                    // this.exit();
                    console.log("HIT!");
                  } else {
                    stone.fill = 'blue';
                  }
                };
            }

          },
        });

       /*
       * メイン処理
       */
      phina.main(function() {
        // アプリケーションを生成
        var app = GameApp({
          title: "トマピコドッジ",
          assets: ASSETS,
          tartLabel: 'main',
        });
        // 実行
        app.run();
      });
    </script>
  </body>
</html>


